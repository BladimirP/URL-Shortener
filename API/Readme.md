# 📄 URL Shortener API Documentation

This project provides the **backend of a URL shortening service**, built with **FastAPI** and **SQLAlchemy**.  
It allows users to shorten URLs, retrieve them using short paths, and redirect to the original URLs.  
It also provides logging and basic analytics like click counts and activation/expiration dates.

## 🗂️ Project Structure

```
/API
│
├── /src
│   ├── /logs              # Directory to store API logs
│   │   └── log            # Log file for tracking requests and errors
│   │
│   ├── /app
│   │   ├── crud.py        # Database operations (Create, Read, Update, Delete)
│   │   ├── database.py    # Database session and configuration
│   │   ├── handler.py     # Business logic and handler functions
│   │   ├── models.py      # SQLAlchemy models for the URL entity
│   │   ├── routes.py      # FastAPI route definitions
│   │   └── schemas.py     # Pydantic schemas for request/response validation
│   │
│   ├── .env               # Environment variables (e.g., DB connection)
│   ├── main.py            # Application entry point
│   └── requirements.txt   # Python dependencies
│
├── /database
│   └── url_shortener.sql  # SQL file for creating database schema
│
└── Readme.md              # Project overview and instructions
```

---
## ⚙️ Environment Variables (`.env`)

The `.env` file contains configuration values used to run the API and connect to the database.

### Required Variables

| Variable Name       | Description                                      | Example                |
|---------------------|--------------------------------------------------|------------------------|
| `DOMAIN`            | Base domain for generated short URLs             | `"http://localhost:8000"` |
| `API_HOST`          | Host address for the API                         | `localhost`            |
| `API_PORT`          | Port on which the API runs                       | `8000`                 |
| `DELTA_TIME`        | Default number of days until expiration          | `3`                    |
| `DATABASE_HOST`     | Hostname of the PostgreSQL database              | `localhost`            |
| `DATABASE_PORT`     | Port of the PostgreSQL database                  | `5432`                 |
| `DATABASE_USER`     | Username for the PostgreSQL connection           | `postgres`             |
| `DATABASE_PASSWORD` | Password for the PostgreSQL connection           | `postgres`             |
| `DATABASE_NAME`     | Name of the database to use                      | `url_shortener`        |

These values must be loaded by the application at runtime. Ensure that the `.env` file is placed at the root of the `/src` folder.

---

---

## 🚀 How to Run the API

1. Install dependencies:

   ```bash
   pip install -r requirements.txt
   ```

2. Run the API:

   ```bash
   python main.py
   ```

---

## 🧩 Models and Schemas

### SQLAlchemy Model: `URL`

Defined in `models.py`, this is the database representation of a URL:

- `id`: Unique identifier
- `original_url`: The full original URL submitted by the user
- `short_url`: The shortened version generated by the API
- `click_count`: Number of times the short URL was accessed
- `activation_date`: When the URL becomes valid
- `expiration_date`: When the URL expires

### Pydantic Schemas

Defined in `schemas.py`, these define how data is validated and structured in API requests/responses:

- `URLCreate`: Input schema for creating a new short URL
  - `original_url`: Required
  - `prefix`: Optional custom path prefix
- `URLResponse`: Output schema for returning URL data
  - Includes all fields from the model plus validation

---

## 🌐 API Endpoints

### `GET /`
- **Description**: Basic root endpoint to verify the API is running.
- **Response**: `"url shortener"`

---

### `GET /url/{url_id}`
- **Description**: Retrieve a shortened URL by its unique ID.
- **Path Parameter**:
  - `url_id` (string): The identifier of the shortened URL.
- **Response**: `URLResponse` schema including:
  - `id`: URL identifier
  - `short_url`: The generated shortened URL
  - `original_url`: The original long URL
- **Errors**: Logs error and raises `HTTPException` if not found.

---

### `GET /urls`
- **Description**: Get a list of all shortened URLs in the database.
- **Response**: List of `URLResponse` objects.

---

### `GET /{path}`
- **Description**: Redirect to the original URL from a shortened path.
- **Path Parameter**:
  - `path` (string): The custom short path in the URL.
- **Response**: Redirects the client to the original URL.
- **Errors**: Returns `404 HTTPException` if the short path doesn't exist and `419 HTTPException` if the short path is expired.

---

### `POST /url`
- **Description**: Create a new shortened URL.
- **Request Body** (`URLCreate` schema):
  - `original_url` (string): The URL to shorten.
- **Response** (`URLResponse`):
  - `id`, `short_url`, `original_url`
- **Errors**: Returns `HTTPException` on invalid input or internal error.

---

## 📝 Logging

- All requests are logged to `./API/src/logs/log` with details:
  - Timestamp
  - Source IP
  - Request type
  - Endpoint accessed
  - Response status code
